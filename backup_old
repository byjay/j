#!/usr/bin/env python3
"""
ë°ì´í„° í’ˆì§ˆ ê²€ì‚¬ - ì˜ëª»ëœ í•œêµ­ì–´, ì˜¤íƒ€ ë“± ì°¾ê¸°
"""
import json
import re

with open(r'f:\genmini\japness\ë³€í™˜\JAP_BONG\js\conversation.js', 'r', encoding='utf-8') as f:
    content = f.read()

start = content.find('const conversationModuleData = ') + len('const conversationModuleData = ')
end = content.find(';\n\nlet currentConversationCategory')
data_str = content[start:end].strip()
data = json.loads(data_str)

print("ğŸ” ë°ì´í„° í’ˆì§ˆ ê²€ì‚¬\n")

issues = []

# íŒ¨í„´ ê²€ì‚¬
patterns = {
    'ë‹ˆë‹¤ë‹ˆë‹¤': r'ë‹ˆë‹¤ë‹ˆë‹¤',
    'ìŠµë‹ˆë‹¤ìŠµë‹ˆë‹¤': r'ìŠµë‹ˆë‹¤ìŠµë‹ˆë‹¤',
    'ì…ë‹ˆë‹¤ì…ë‹ˆë‹¤': r'ì…ë‹ˆë‹¤ì…ë‹ˆë‹¤',
    '...' : r'\.\.\.',  # ì—°ì† ë§ˆì¹¨í‘œ
    '  ': r'  ',  # ì—°ì† ê³µë°±
    'ã€‚': r'ã€‚',  # ì¼ë³¸ì–´ ë§ˆì¹¨í‘œê°€ í•œêµ­ì–´ì—
}

for cat_key, cat_data in data.items():
    for i, conv in enumerate(cat_data.get('conversations', [])):
        # question ê²€ì‚¬
        kr = conv['question'].get('kr', '')
        jp = conv['question'].get('jp', '')
        
        # íŒ¨í„´ ë§¤ì¹­
        for pattern_name, pattern in patterns.items():
            if re.search(pattern, kr):
                issues.append({
                    'category': cat_key,
                    'index': i,
                    'type': 'question',
                    'issue': f'í•œêµ­ì–´ì— {pattern_name} í¬í•¨',
                    'kr': kr,
                    'jp': jp
                })
        
        # í•œêµ­ì–´ì— ì¼ë³¸ì–´ ë¬¸ì ê²€ì‚¬
        if re.search(r'[\u3040-\u309F\u30A0-\u30FF]', kr):
            issues.append({
                'category': cat_key,
                'index': i,
                'type': 'question',
                'issue': 'í•œêµ­ì–´ì— ì¼ë³¸ì–´ í¬í•¨',
                'kr': kr,
                'jp': jp
            })

print(f"ë°œê²¬ëœ ë¬¸ì œ: {len(issues)}ê°œ\n")

if issues:
    print(f"{'ì¹´í…Œê³ ë¦¬':<15} {'ì¸ë±ìŠ¤':<8} {'íƒ€ì…':<10} {'ë¬¸ì œ':<20} {'í•œêµ­ì–´':<40}")
    print("=" * 100)
    for issue in issues[:30]:  # ì²˜ìŒ 30ê°œë§Œ
        kr_short = issue['kr'][:37] + '...' if len(issue['kr']) > 40 else issue['kr']
        print(f"{issue['category']:<15} {issue['index']:<8} {issue['type']:<10} {issue['issue']:<20} {kr_short:<40}")
    
    if len(issues) > 30:
        print(f"\n... ì™¸ {len(issues) - 30}ê°œ ë”")
else:
    print("âœ… ë¬¸ì œ ì—†ìŒ!")
